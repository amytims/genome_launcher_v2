// set some defaults for pipeline parameters
params {
    indir = 'results/raw_reads'
    outdir = 'results'
    pacbio_data = false
    hic_data = false
    ont_data = false
    
    filter_pacbio_adapters = true
    pacbio_adapters_fasta = "${projectDir}/assets/pacbio_adapters.fa"

    read_length_summary = true
}

profiles {

    pawsey {

        params {
            // config_profile_description = 'Pawsey Setonix HPC profile provided by nf-core/configs'
            // config_profile_contact     = 'Sarah Beecroft (@SarahBeecroft), Georgie Samaha (@georgiesamaha)'
            // config_profile_url         = 'https://support.pawsey.org.au/documentation/display/US/Setonix+User+Guide'
            max_cpus                   = 64
            max_memory                 = 230.GB
        }

        // Enable use of Singularity to run containers
        singularity {
            enabled     = true
            autoMounts  = true
            autoCleanUp = true
        }

        // Submit up to 1024 concurrent jobs
        executor {
            queueSize = 1024
        }

        // Define process resource limits
        // See: https://support.pawsey.org.au/documentation/pages/viewpage.action?pageId=121479736#RunningJobsonSetonix-Overview
        process {
            resourceLimits = [
                memory: 230.GB,
                cpus: 64
            ]
            executor       = 'slurm'
            clusterOptions = "--account=${System.getenv('PAWSEY_PROJECT')}"
            module         = 'singularity/4.1.0-nohost'
            cache          = 'lenient'
            stageInMode    = 'symlink'
            queue = { task.memory <= 230.GB ? 'work' : 'highmem' }

            withName: BAM_TO_FASTQ {
                container = 'quay.io/biocontainers/samtools:1.22.1--h96c455f_0'
                cpus = 8
                ntasks = 1
                memory = 16.GB
                time = '2h'
            }

            withName: CUTADAPT {
                container = 'community.wave.seqera.io/library/cutadapt:5.0--991bbd2e184b7014'
                ext.args = '--error-rate 0.1 --overlap 25 --match-read-wildcards --revcomp --discard-trimmed'
                cpus = 8
                ntasks = 1
                memory = 16.GB
                time = '2h'
            }

            withName: READ_LENGTH_SUMMARY {
                container = 'quay.io/biocontainers/samtools:1.22.1--h96c455f_0'
                cpus = 1
                ntasks = 1
                memory = 4.GB
                time = '1h'
            }

            withName: PLOT_READ_LENGTHS {
                cpus = 1
                ntasks = 1
                memory = 4.GB
                time = '1h'
            }

            withName: CONCAT_PACBIO_READS {
                cpus = 8
                memory = 8.GB
                time = '2h'
                queue = 'work'
            }
        }

        aws { 
            client {
                endpoint = 'https://projects.pawsey.org.au'
                s3PathStyleAccess = true
                maxConnections = 4
                maxErrorRetry = 20
                uploadMaxAttempts = 20
            }
        }
    }
}            